## 6.3 中间件-缓存

>date: 2019-05-12

![](../assets/images/63.jpg)

### 6.3.1 概述

在高并发的分布式的系统中，缓存是必不可少的一部分。没有缓存对系统的加速和阻挡大量的请求直接落到系统的底层，系统是很难撑住高并发的冲击，所以分布式系统中缓存的设计是很重要的一环。

#### 原理

分布式缓存的出现主要是为了帮助高并发访问时，加快系统数据的读写，相较于传统的数据存储层（例如`MySQL`），缓存一般是缓存在内存中的，其性能比传统的数据库存储更好，响应速度更快，能更好地提升用户体验。

同时缓存也能缓存一些复杂耗时的计算结果，降低后端系统对`CPU`、`I/O`、线程等资源的需求，让系统运行在一个相对资源健康的环境。

但是适用分布式缓存随之而来会出现一些问题，诸如数据一致性问题、代码维护、运维成本等等。

#### 设计

设计缓存的时候，需要思考这些问题：

1. 缓存什么内容：缓存热点数据、静态资源等等

2. 缓存放在什么位置：`CDN`、反向代理、分布式缓存服务、本机

3. 如何缓存：如何设计缓存过期策略、设计缓存同步机制等等

### 6.3.2 缓存的应用

#### `CDN`缓存

`CDN`缓存一般缓存静态资源文件（页面、脚本、图片、视频、文件等），在复杂的网络环境下，其解决的是跨运营商和各地用户访问网络拥塞、响应速度缓慢、命中率低等问题。

`CDN`的基本原理是广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络中，用户访问网站时，利用全局负载技术将用户的访问指向距离最近的缓存服务器上，由缓存服务器直接响应用户请求。

其具有本地`Cache`加速、不同网络环境下用户都具有良好的访问质量、加快访问速度、减轻原站点的负载压力、有效降低网络攻击影响等优点。

#### 反向代理缓存

反向代理是指在网站服务器机房部署代理服务器，实现负载均衡，数据缓存，安全控制等功能。

反向代理位于应用服务器机房，处理所有对`Web`服务器的请求。反向代理一般缓存静态资源，动态资源转发到应用服务器处理。

如果用户请求的页面在代理服务器上有缓冲的话，代理服务器直接将缓冲内容发送给用户。

如果没有缓冲则先向`Web`服务器发出请求，取回数据，本地缓存后再发送给用户。通过降低向`Web`服务器的请求数，从而降低了`Web`服务器的负载。

常用的缓存应用服务器有`Varnish`，`Ngnix`，`Squid`。

* 反向代理和正向代理

正向代理是代理客户端，为客户端收发请求，使真实客户端对服务器不可见；而反向代理是代理服务器端，为服务器收发请求，使真实服务器对客户端不可见。

#### 分布式缓存

#### 本地缓存

### 6.3.3 缓存架构

### 6.3.4 数据一致性

### 6.3.5 高可用

### 6.3.6 缓存雪崩

### 6.3.7 缓存穿透
