## 6.1 分布式概述

>date: 2019-12-09

![](../assets/images/61.jpg)

### 6.1.1 什么是分布式

分布式就是将相同或相关的程序运行在多台服务器上，从而实现特定目标的一种计算方式。

分布式系统是作为单个完整服务展现在终端用户面前的一组协同工作服务器。组中的服务器共享状态、同步操作，并且任意某个服务器独立故障时都不会影响整个系统的正常运行。

* **分布式**和**集群**的区别：

**分布式**：将一个业务拆分成不同的子业务，分布在不同的服务器上执行；

**集群**：多台服务器集中在一起，实现同一业务或功能。

### 6.1.2 分布式发展历程

1. 单机模式

所有的应用程序和数据均部署在一台服务器上，由一台服务器完成所有的处理。

**缺点：**所有资源共用一台服务器，性能受限，存在单点失效问题。

2. 数据并行或数据分布式

为了解决单台服务器存在性能和可用性的问题，出现了数据并行的模式，其可以看做分成两个阶段进行。

a. 应用和数据的分离，分别部署在不同的服务器上；

b. 对数据进行拆分，将同一类型的数据拆分到两个或更多的数据库中，应用针对不同的功能去相应的数据库上取用数据，不同任务针对不同类型的数据就能实现并行处理。

多台服务器并行处理多个任务，解决单机模式的性能瓶颈。

**需要考虑的问题：**

* 部署在不同服务器上的相同的应用，需要考虑均衡接收任务并处理的问题；

* 数据库的读写频繁时候，数据库的`IO`是瓶颈，数据库读写分离，需要考虑**读**和**写**之间的效率平衡，同时要考虑数据同步的一致性问题；

* 热点数据的频繁访问，会导致数据库的压力增大，需要考虑使用缓存机制来减小压力并提升查询效率。

**缺点：**针对上面需要考虑的问题，如果单个任务执行时间过长，需要较多资源时，针对提高执行效率和性能问题，这个模式无法解决。

3. 任务并行或任务分布式

针对数据并行时候，无法提高单个任务的执行性能问题，出现了任务并行模式。

其实现原理就是将单个复杂任务拆分成多个子任务，将子任务分散到不同的服务器上并行执行，只要一个复杂任务中的任意子任务的执行时间变短了，那么这个业务的整体执行时间也就变短了。

**缺点：**这种模式自然能带来更好的性能、扩展性、可维护性，但是如何设计任务的并行执行，不仅关乎任务并行的设计，还关乎如何对一些大型业务的拆分。

### 6.1.3 分布式系统指标

分布式的目的是使用更多的服务器，处理更多的数据和更复杂的任务，所以**性能**、**资源**、**可用性**和**可扩展性**是验证一个分布式系统能否达到上述要求的重要指标。

* **性能**

**性能**主要用于衡量一个系统处理各种任务的能力。

常见的性能指标，包括**吞吐量**(`Throughput`)、**响应时间**(`Response Time`)和**完成时间**(`Turnaround Time`)。

- * **吞吐量**：系统在一定时间内可以处理的任务数。常见的吞吐量指标有 `QPS`(`Queries Per Second`)、`TPS`(`Transactions Per Second`)和 `BPS`(`Bits Per Second`)。

`QPS`：查询数每秒，用于衡量一个系统每秒处理的查询数。这个指标通常用于读操作，越高说明对读操作的支持越好。如果应用主要是读操作，那么需要重点考虑如何提高 `QPS`，来支持高频的读操作。

`TPS`：事务数每秒，用于衡量一个系统每秒处理的事务数。这个指标通常对应于写操作，越高说明对写操作的支持越好。如果应用主要是写操作，那么需要重点考虑如何提高 `TPS`，来支持高频写操作。

`BPS`：比特数每秒，用于衡量一个系统每秒处理的数据量。不同的事务之间的处理的数据量大小不同，针对这种处理数据较多的系统，不能简单地按照请求数或事务数来衡量其性能，这种情况下，`BPS` 更能客观地反应系统的吞吐量。

- * **响应时间**：指系统响应一个请求或事务所需花费的时间。直接影响到用户的体验，对一些时延敏感的业务很重要。

- * **完成时间**：系统真正完成一个请求或处理需要花费的时间。任务并行模式出现的其中一个目的，就是缩短整个任务的完成时间。当需要计算海量数据或处理大规模任务时，这个指标很重要。


* **资源占用**

**资源占用**指的是一个系统提供正常能力需要占用的硬件资源。

一个系统在没有任何负载时的资源占用，叫做**空载资源占用**，体现了这个系统自身的资源占用情况。对于同样的功能，空载资源占用越少，说明系统设计越优秀，负载处理事务时候的资源也越足。

一个系统满额负载时的资源占用，叫做**满载资源占用**，体现了这个系统全力运行时占用资源的情况，也体现了系统的处理能力。同样的硬件配置上，运行的业务越多，资源占用越少，说明这个系统设计得越好。

* **可用性**

**可用性**通常指的是系统在面对各种异常时可以正确提供服务的能力。可用性是分布式系统的一项重要指标，衡量了系统的鲁棒性，是系统容错能力的体现。

系统的可用性可以用**系统停止服务的时间与总的时间之比衡量**，还可以用**某功能的失败次数与总的请求次数之比来衡量**。

* **可扩展性**

**可扩展性**指的是分布式系统通过扩展集群机器规模提高系统性能 (吞吐、响应时间、 完成时间)、存储容量、计算能力的特性，是分布式系统的特有性质。

当任务的需求随着具体业务不断提高时，除了升级系统的性能做**垂直/纵向扩展**外，另一个做法就是通过增加服务器的方式去**水平/横向扩展**系统规模。

好的分布式系统总在追求**线性扩展性**，也就是说系统的某一指标可以随着集群中的机器数量呈线性增长。

衡量系统可扩展性的常见指标是**加速比**(`Speedup`)，也就是一个系统进行扩展后相对扩展前的性能提升。